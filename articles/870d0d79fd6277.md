---
title: "TypeScriptã«ã¦å‹ãƒ¬ãƒ™ãƒ«ã§å‹ã‚¬ãƒ¼ãƒ‰ã‚’å®Ÿç¾ã™ã‚‹"
emoji: "ğŸ›¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["TypeScript"]
published: false
---
:::message

ã“ã®è¨˜äº‹ã¯éå»ã«æ›¸ã„ãŸè¨˜äº‹ã«ä¸€éƒ¨ä¿®æ­£ã—ãŸç§»æ¤ã«ãªã‚Šã¾ã™ã€‚
-  [tsã§objectã®å…±ç”¨ä½“å‹(union type)ã‹ã‚‰ç‰¹å®šã®å‹ã‚’å–ã‚Šå‡ºã™util typeã‚’å®Ÿè£…ã™ã‚‹ - Qiita](https://qiita.com/katsuya_U/items/6269b50f27b54bb84fff)

:::


## æ¦‚è¦

```typescript

type SuccessResult = {
  status: "success"
}

type ErrorResult = {
  status: "error"
  errorCode: number
  errorMessage: string
}

type AbortResult = {
  status: "abort"
}

export type Result = SuccessResult | ErrorResult | AbortResult
```
â†‘ã“ã®ã‚ˆã†ãªå‹ãŒå®šç¾©ã—ã¦ã‚ã£ãŸã¨ã—ã¦

```typescript
declare const result: Result

result.errorCode // error! ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ 'errorCode' ã¯å‹ 'Result' ã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚

if (result.status === "error") {
  // result is ErrorResult
  result.errorCode // ok!
}

```

[å‹ã‚¬ãƒ¼ãƒ‰](https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types)ã«ã‚ˆã£ã¦ã€`result.status === "error"`ã®æ™‚`result`ã¯`ErrorResult`å‹ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ã‹ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®tsã®å‹æ©Ÿèƒ½ã ã‘ã§`Result`å‹ã®ã‚ˆã†ãªå…±ç”¨ä½“å‹ã‹ã‚‰ç‰¹å®šã®å‹ã‚’å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãã“ã§ã€

```typescript
type ErrorResult2 = FindFromUnion<Result, "status", "error">
// ErrorResult2 is ErrorResult
```

ä¸Šè¨˜ã®ã‚ˆã†ãªã€3ã¤ã®å‹

- objectã®å…±ç”¨ä½“å‹
- keyã¨ãªã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å(string literalå‹)
- ç‰¹å®šã®ã®keyã¨ä¸€è‡´ã™ã‚‹åç§°(string literalå‹)

ã‚’æŒ‡å®šã—ã¦ã€å…±ç”¨ä½“å‹ã‹ã‚‰ç‰¹å®šã®å‹ã‚’å–ã‚Šå‡ºã™`FindFromUnion`å‹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## å®Ÿè£…

ts 4.3.5ã§ç¢ºèªã—ã¦ã„ã¾ã™ã€‚([å…¨ä½“ã®ã‚½ãƒ¼ã‚¹ã®ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ãƒ³ãƒ‰](https://www.typescriptlang.org/ja/play?ssl=42&ssc=2&pln=38&pc=1#code/C4TwDgpgBAYglgOwCYwE4HsC2BVBd0IA8AUFFACoCGqA5hMFBAB7ATIDOUA3gL4A0pKAGkIIAAoYwjFmyScA1qPQAzCtTrABZESGmsOa2vQDaOiejABdYgD4oAXkMa9szlyjGmURMNHmrAFy+ujxQAPxO9FBBCBAAbhCogsSgkFAAygCuAMbZEOzsAEr5mQA2DI5cguzAlMCZ7EEAROw5eQVNxDzEKeDQAKKoGKjFreUO3NW19Y1QTYnDnWQL6KgAwuhIEDGZmABGiYIrqACy+eyUdEE1qIg0XT2p0ACCe6vAo2UVk2Q1dQ3NShvVDATrdXppT7jRxZXLnKEMAA+UEGwwRUGRr3eCMefSgCJOlCklUExgR6WmDW8CHxJXKxhalPYTUsliC8GQaCwuHwRARfDmfxmTQF5KZNgeAHoAFTEAlEiZVX5tc5BWHtIp04AAbiOQ1WQVRqwRurIQPeQSxIJND2lktxkK1MEyCGyhOJPw8Yv+nB8CIZQoaLMsYSCAApUFr2YgUBgcHgCIR+YKmSLaWNgBSfTYAJQOOxxdBwJBS2UI52u92K6oqgqhqBhiNRjK1zUZvP2AtFpB55EurbKRAQJCmxj61D1xuRjOG8cIjtd4u9qD9iCD2IjwTmkGTpszqBWj5ahdQQtLjEr5Broeb7p2nrZAg1KDsegIgASlGQpUSEzDAAsvyQH9TiJIJyxdN0iRPJUoElSUoAAOmQh5iFfI8M0-b9EjDWDWjhAowzzWCyHgqBskoV8X1bQR+D1YZcLHYYNi2AVjjOApLmgHhiMEUiEIoqjjlogQeKAA))

```typescript
type FindFromUnion<
  Target extends {},
  KeyProp extends keyof Target,
  Key extends Target[KeyProp]
> = Target extends { [x in KeyProp]: Key } ? Target : never;
```

:::details tsã®çµ„ã¿è¾¼ã¿å‹ã‚’ä½¿ã†å ´åˆ

```typescript
type FindFromUnion<
  Target extends {},
  KeyProp extends keyof Target,
  Key extends Target[KeyProp]
> = Extract<Target, Record<KeyProp, Key>>
```

ã“ã¡ã‚‰ã®æ–¹ãŒè¦‹ã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚

:::



## ãªãœã“ã‚ŒãŒå¿…è¦ãªã®ã‹

ã¯ã£ãã‚Šè¨€ã£ã¦`ErrorResult2`å‹ã®ã‚ˆã†ãªä½¿ã„æ–¹ã¯ã‚ã¾ã‚Šã—ãªã„ã¨æ€ã„ã¾ã™ã€‚
ãªãœãªã‚‰ãã‚‚ãã‚‚å…ƒã®`ErrorResult`å‹ã‚’exportã™ã‚Œã°è‰¯ã„ã‹ã‚‰ã§ã™ã€‚

ã§ã¯ã€ãªãœ`FindFromUnion`å‹ãŒå¿…è¦ã«ãªã£ãŸã®ã‹ï¼Ÿ

ãã‚Œã¯ã€[Mapped types](https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types)ã‚’ä½¿ã£ã¦å‹ã‚’å‹•çš„ã«ä½œã‚‹ã¨ãã«çµ¶å¤§ãªãƒ‘ãƒ¯ãƒ¼ã‚’ç™ºæ®ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚

```typescript
// Result["status"] = "success" | "error" | "abort"
type ResultMap = {
  [ResultStatus in Result["status"]]: ResultStatus
}
/*
ResultMap is {
  success: "success";
  error: "error";
  abort: "abort";
}
*/
```

æœ€åˆã«å‡ºã¦ããŸ`Result`å‹ã‚’ä½¿ã£ã¦ã€ä¸Šè¨˜ã®ã‚ˆã†ãª`ResultMap`å‹ãŒä½œã‚Œã¾ã™ã€‚
é‡è¦ãªã®ã¯ã€`ResultStatus`å‹ãŒãã‚Œãã‚Œã€`"success"`å‹ã€`"error"`å‹ã€`"abort"`å‹ã«ãªã‚‹ã“ã¨ã§ã™ã€‚

ã“ã‚Œã«`FindFromUnion`å‹ã‚’ä½¿ã†ã¨ã€

```typescript
type ResultMap = {
  [ResultStatus in Result["status"]]: FindFromUnion<Result, "status", ResultStatus>
}
/*
ResultMap is {
  success: SuccessResult;
  error: ErrorResult;
  abort: AbortResult;
}
*/
```

ã“ã®ã‚ˆã†ã«ã€å…±ç”¨ä½“å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã€å‹•çš„ã«objectã‚’ä½œã‚‹ãªã‚“ã¦ã“ã¨ãŒã§ãã‚‹ã‚“ã§ã™ï¼ï¼ï¼

ã‚‚ã¡ã‚ã‚“ã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã‚„ã€é–¢æ•°ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™

```typescript
type ResultFuncMap = {
  [ResultStatus in Result["status"]]?: (result: FindFromUnion<Result, "status", ResultStatus>) => void
}
/*
ResultFuncMap = {
  success?: ((result: SuccessResult) => void) | undefined;
  error?: ((result: ErrorResult) => void) | undefined;
  abort?: ((result: AbortResult) => void) | undefined;
}
*/
```

ã•ã‚‰ã«ã•ã‚‰ã«ã€ResultFuncMapã‚’ä½¿ã£ã¦ã“ã‚“ãªã“ã¨ã‚‚ã§ãã¾ã™

```typescript

const setResultHandler = (handlerMap: ResultFuncMap) => {
  // ä½•ã‹ã—ã‚‰ã®å‡¦ç†
}

setResultHandler({
  success() {
    // æˆåŠŸæ™‚ã®å‡¦ç†
  },
  //     â†“ ErrorResultã‚’ãã®ã¾ã¾å¼•æ•°ã«åˆ†å‰²ã—ã¦ã„ã‚‹
  error({ errorCode, errorMessage }) {
    // ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
  },
})
```

## ã¾ã¨ã‚


objectã®å…±ç”¨ä½“å‹ã‹ã‚‰ç‰¹å®šã®å‹ã‚’å–ã‚Šå‡ºã™`FindFromUnion`å‹ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚

`FindFromUnion`å‹ã‚’ä½¿ã†æ©Ÿä¼šã¯ã‚ã¾ã‚Šãªã•ãã†ã§ã™ãŒã€Mapped typesã¨åˆã‚ã›ã¦ä½¿ã†ã¨ã¨ã¦ã‚‚å¼·åŠ›ãªã®ã§ã€æ˜¯éä½¿ã£ã¦ã¿ã¦ãã ã•ã„ï¼
